<!-- ç¬¬ä¸€æ­¥ï¼šå…ˆå®šä¹‰å…¨å±€æ ·å¼ï¼Œå¼ºåˆ¶éšè— JupyterLite æ‰€æœ‰å†…å®¹ï¼Œç›´åˆ°éªŒè¯é€šè¿‡ -->
<style>
    /* 1. å¼ºåˆ¶éšè—æ•´ä¸ªé¡µé¢çš„æ‰€æœ‰å†…å®¹ï¼ˆé™¤äº†ç™»å½•é®ç½©ï¼‰ */
    body * {
        display: none !important;
    }

    /* 2. ç™»å½•é®ç½©æ ·å¼ï¼ˆå•ç‹¬ç”Ÿæ•ˆï¼Œä¸è¢«ä¸Šé¢çš„å…¨å±€éšè—å½±å“ï¼‰ */
    #loginMask {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        z-index: 999999 !important;
        margin: 0 !important;
        padding: 0 !important;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
    }

    /* 3. ç™»å½•æ¡†å†…éƒ¨æ ·å¼ */
    #loginMask .login-container {
        width: 100% !important;
        max-width: 400px !important;
        background: #ffffff !important;
        border-radius: 12px !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15) !important;
        padding: 48px 32px !important;
        display: block !important;
        animation: slideIn 0.4s ease-out !important;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    #loginMask .login-title {
        text-align: center !important;
        color: #2c3e50 !important;
        font-size: 24px !important;
        margin-bottom: 8px !important;
        font-weight: 600 !important;
        display: block !important;
    }

    #loginMask .login-subtitle {
        text-align: center !important;
        color: #7f8c8d !important;
        font-size: 14px !important;
        margin-bottom: 32px !important;
        display: block !important;
    }

    #loginMask .error-tip {
        text-align: center !important;
        color: #ffffff !important;
        background: #e74c3c !important;
        font-size: 14px !important;
        margin-bottom: 20px !important;
        padding: 12px !important;
        border-radius: 6px !important;
        opacity: 0 !important;
        transition: opacity 0.3s ease !important;
        display: block !important;
        border-left: 4px solid #c0392b !important;
    }

    #loginMask .error-tip.show {
        opacity: 1 !important;
    }

    #loginMask .password-input {
        width: 100% !important;
        padding: 16px !important;
        border: 2px solid #dce4ec !important;
        border-radius: 8px !important;
        font-size: 16px !important;
        color: #34495e !important;
        margin-bottom: 24px !important;
        display: block !important;
        box-sizing: border-box !important;
        transition: border-color 0.3s ease !important;
    }

    #loginMask .password-input:focus {
        outline: none !important;
        border-color: #667eea !important;
    }

    #loginMask .password-input::placeholder {
        color: #95a5a6 !important;
    }

    #loginMask .submit-btn {
        width: 100% !important;
        padding: 16px !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: #ffffff !important;
        border: none !important;
        border-radius: 8px !important;
        font-size: 16px !important;
        font-weight: 600 !important;
        cursor: pointer !important;
        display: block !important;
        transition: transform 0.2s, box-shadow 0.2s !important;
    }

    #loginMask .submit-btn:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4) !important;
    }

    #loginMask .submit-btn:active {
        transform: translateY(0) !important;
    }

    #loginMask .submit-btn:disabled {
        opacity: 0.6 !important;
        cursor: not-allowed !important;
        transform: none !important;
    }

    /* 4. éªŒè¯é€šè¿‡åï¼Œè§£é”é¡µé¢çš„æ ·å¼ */
    body.unlock * {
        display: initial !important;
    }
    body.unlock #loginMask {
        display: none !important;
    }
</style>

<!-- ç¬¬äºŒæ­¥ï¼šç™»å½•é®ç½©å±‚ï¼ˆå”¯ä¸€ä¸è¢«å…¨å±€éšè—çš„å…ƒç´ ï¼‰ -->
<div id="loginMask">
    <div class="login-container">
        <h2 class="login-title">ğŸ”¬ JupyterLite</h2>
        <p class="login-subtitle">è¯·è¾“å…¥è®¿é—®å¯†ç </p>
        <div class="error-tip" id="errorTip">âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
        <input type="password" class="password-input" id="passwordInput" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç " autocomplete="off">
        <button class="submit-btn" id="submitBtn" onclick="verifyPassword()">ğŸ”“ ç¡®è®¤è®¿é—®</button>
    </div>
</div>

<!-- ç¬¬ä¸‰æ­¥ï¼šç«‹å³æ‰§è¡Œçš„éªŒè¯è„šæœ¬ -->
<script>
(function() {
    'use strict';
    
    // ======================== é…ç½®åŒºåŸŸ ========================
    const CONFIG = {
        // å¯†ç çš„ SHA-256 å“ˆå¸Œå€¼
        // å¦‚éœ€ä¿®æ”¹å¯†ç ï¼Œè¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œä¸‹é¢çš„ä»£ç ç”Ÿæˆæ–°å“ˆå¸Œï¼š
        // async function hash(pwd) { const b = new TextEncoder().encode(pwd); const h = await crypto.subtle.digest('SHA-256', b); return Array.from(new Uint8Array(h)).map(b => b.toString(16).padStart(2, '0')).join(''); }
        // hash('ä½ çš„å¯†ç ').then(console.log)
        passwordHash: "3c9f0ea65fca3ca5fbb3d558bc3c704ee06f94ea8e828ca0e9f8f8c73f8c0fcf",
        
        // ä¼šè¯æœ‰æ•ˆæœŸï¼ˆæ¯«ç§’ï¼‰- é»˜è®¤ 4 å°æ—¶
        sessionDuration: 4 * 60 * 60 * 1000,
        
        // å­˜å‚¨é”®å
        storageKey: 'jupyterlite_auth_token'
    };
    
    // ======================== å·¥å…·å‡½æ•° ========================
    
    // SHA-256 å“ˆå¸Œå‡½æ•°
    async function sha256(message) {
        const msgBuffer = new TextEncoder().encode(message);
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }
    
    // æ£€æŸ¥è®¤è¯çŠ¶æ€
    function checkAuth() {
        try {
            // å…ˆæ£€æŸ¥ sessionStorage
            let authData = sessionStorage.getItem(CONFIG.storageKey);
            
            // å¦‚æœ session ä¸­æ²¡æœ‰ï¼Œå°è¯•ä» localStorage æ¢å¤ï¼ˆæ”¯æŒåˆ·æ–°åè®°ä½ç™»å½•çŠ¶æ€ï¼‰
            if (!authData) {
                authData = localStorage.getItem(CONFIG.storageKey);
                if (authData) {
                    sessionStorage.setItem(CONFIG.storageKey, authData);
                }
            }
            
            if (!authData) return false;
            
            const auth = JSON.parse(authData);
            const now = Date.now();
            
            // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
            if (!auth.authenticated || !auth.expires || now > auth.expires) {
                // æ¸…é™¤è¿‡æœŸçš„è®¤è¯ä¿¡æ¯
                sessionStorage.removeItem(CONFIG.storageKey);
                localStorage.removeItem(CONFIG.storageKey);
                return false;
            }
            
            return true;
        } catch (e) {
            console.error('Auth check error:', e);
            return false;
        }
    }
    
    // è®¾ç½®è®¤è¯çŠ¶æ€
    function setAuth() {
        const authData = {
            authenticated: true,
            timestamp: Date.now(),
            expires: Date.now() + CONFIG.sessionDuration
        };
        const authString = JSON.stringify(authData);
        sessionStorage.setItem(CONFIG.storageKey, authString);
        localStorage.setItem(CONFIG.storageKey, authString);
    }
    
    // è§£é”é¡µé¢
    function unlockPage() {
        document.body.classList.add('unlock');
        // ç§»é™¤é˜²æŠ¤å®šæ—¶å™¨
        if (window.protectionTimer) {
            clearInterval(window.protectionTimer);
        }
    }
    
    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(message) {
        const errorTip = document.getElementById('errorTip');
        if (message) {
            errorTip.textContent = message;
        }
        errorTip.classList.add('show');
        
        setTimeout(() => {
            errorTip.classList.remove('show');
        }, 3000);
    }
    
    // ======================== å¯†ç éªŒè¯ ========================
    
    window.verifyPassword = async function() {
        const inputPassword = document.getElementById('passwordInput').value.trim();
        const submitBtn = document.getElementById('submitBtn');
        const errorTip = document.getElementById('errorTip');
        
        // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯æç¤º
        errorTip.classList.remove('show');
        
        if (!inputPassword) {
            showError('âŒ è¯·è¾“å…¥å¯†ç ');
            return;
        }
        
        // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
        submitBtn.disabled = true;
        submitBtn.textContent = 'â³ éªŒè¯ä¸­...';
        
        try {
            // è®¡ç®—å¯†ç å“ˆå¸Œ
            const hash = await sha256(inputPassword);
            
            if (hash === CONFIG.passwordHash) {
                // å¯†ç æ­£ç¡®
                setAuth();
                submitBtn.textContent = 'âœ… éªŒè¯æˆåŠŸï¼';
                submitBtn.style.background = '#27ae60';
                
                // å»¶è¿Ÿè§£é”ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸæç¤º
                setTimeout(() => {
                    unlockPage();
                }, 500);
            } else {
                // å¯†ç é”™è¯¯
                showError('âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸ”“ ç¡®è®¤è®¿é—®';
            }
        } catch (e) {
            console.error('Verification error:', e);
            showError('âŒ éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•');
            submitBtn.disabled = false;
            submitBtn.textContent = 'ğŸ”“ ç¡®è®¤è®¿é—®';
        }
    };
    
    // æ”¯æŒå›è½¦é”®è§¦å‘
    document.getElementById('passwordInput').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            verifyPassword();
        }
    });
    
    // ======================== åˆå§‹åŒ– ========================
    
    // å¼ºåˆ¶é”ä½é¡µé¢
    document.body.classList.remove('unlock');
    
    // æ£€æŸ¥æ˜¯å¦å·²ç»è®¤è¯
    if (checkAuth()) {
        // å·²è®¤è¯ï¼Œç›´æ¥è§£é”
        unlockPage();
    } else {
        // æœªè®¤è¯ï¼Œæ˜¾ç¤ºç™»å½•ç•Œé¢
        document.getElementById('loginMask').style.display = 'flex';
        
        // é˜²æ­¢é¡µé¢è¢«å…¶ä»–è„šæœ¬æå‰è§£é”ï¼ˆå®šæ—¶æ£€æŸ¥ï¼‰
        window.protectionTimer = setInterval(() => {
            if (!document.body.classList.contains('unlock')) {
                document.body.classList.remove('unlock');
            }
        }, 100);
        
        // è‡ªåŠ¨èšç„¦å¯†ç è¾“å…¥æ¡†
        setTimeout(() => {
            document.getElementById('passwordInput').focus();
        }, 100);
    }
})();
</script>
